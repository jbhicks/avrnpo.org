<!-- Posts Management Content (HTMX Partial) -->
<header class="admin-header">
  <div>
    <h1>Manage Posts</h1>
    <p>Create, edit, and manage blog posts for American Veterans Rebuilding.</p>
  </div>
  <a href="/admin/posts/new" role="button" hx-get="/admin/posts/new" hx-target="#main-content" hx-push-url="true">Create New Post</a>
</header>

<%= if (len(posts) > 0) { %>
<!-- Search and Filter -->
<div class="search-bar">
  <input type="search" name="search" placeholder="Search posts..." value="<%= search %>"
         hx-get="/admin/posts" hx-target="#main-content" hx-trigger="input changed delay:300ms, search">

  <select name="status" hx-get="/admin/posts" hx-target="#main-content" hx-trigger="change">
    <option value="">All Posts</option>
    <option value="published" <%= if (status == "published") { %>selected<% } %>>Published</option>
    <option value="draft" <%= if (status == "draft") { %>selected<% } %>>Draft</option>
  </select>
</div>

<!-- Posts Table -->
<div class="posts-table">
  <table>
    <thead>
      <tr>
        <th><input type="checkbox" id="select-all"></th>
        <th>Title</th>
        <th>Author</th>
        <th>Status</th>
        <th>Created</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <%= for (post) in posts { %>
      <tr>
        <td><input type="checkbox" name="post_ids" value="<%= post.ID %>"></td>
        <td>
          <strong><%= post.Title %></strong>
          <%= if (post.Excerpt != "") { %>
            <br><small class="text-muted"><%= post.Excerpt %></small>
          <% } %>
        </td>
        <td>
          <%= if (post.User.Name != "") { %>
            <%= post.User.Name %>
          <% } else { %>
            <%= post.User.Email %>
          <% } %>
        </td>
        <td>
          <%= if (post.Published) { %>
            <span class="status-success">‚úì Published</span>
          <% } else { %>
            <span class="status-warning">üìù Draft</span>
          <% } %>
        </td>
        <td><%= dateFormat(post.CreatedAt, "2006-01-02") %></td>
        <td>
          <div class="table-actions">
            <a href="/admin/posts/<%= post.ID %>" role="button" class="secondary outline btn-sm"
               hx-get="/admin/posts/<%= post.ID %>" hx-target="#main-content" hx-push-url="true">View</a>
            <a href="/admin/posts/<%= post.ID %>/edit" role="button" class="secondary outline btn-sm"
               hx-get="/admin/posts/<%= post.ID %>/edit" hx-target="#main-content" hx-push-url="true">Edit</a>
            <button type="button" class="outline btn-sm btn-danger"
                    hx-delete="/admin/posts/<%= post.ID %>" hx-confirm="Are you sure you want to delete this post?"
                    hx-target="#main-content" hx-swap="outerHTML">Delete</button>
          </div>
        </td>
      </tr>
      <% } %>
    </tbody>
  </table>
</div>

<!-- Bulk Actions -->
<div class="bulk-actions">
  <span>With selected posts:</span>
  <form hx-post="/admin/posts/bulk" hx-target="#main-content" class="inline-form">
    <input type="hidden" name="action" value="publish">
    <button type="submit" class="outline" hx-indicator="#bulk-loading">Publish</button>
  </form>
  <form hx-post="/admin/posts/bulk" hx-target="#main-content" class="inline-form">
    <input type="hidden" name="action" value="unpublish">
    <button type="submit" class="outline" hx-indicator="#bulk-loading">Unpublish</button>
  </form>
  <form hx-post="/admin/posts/bulk" hx-target="#main-content" class="inline-form">
    <input type="hidden" name="action" value="delete">
    <input type="hidden" name="confirm_delete" value="true">
    <button type="submit" class="outline btn-danger"
            hx-confirm="Are you sure you want to delete the selected posts? This action cannot be undone."
            hx-indicator="#bulk-loading">
      Delete
    </button>
  </form>
  <div id="bulk-loading" class="htmx-indicator" style="display: none;">
    <small>Processing...</small>
  </div>
</div>

<script>
// Select all functionality (simple DOM manipulation, no HTMX needed)
document.addEventListener('DOMContentLoaded', function() {
  const selectAllCheckbox = document.getElementById('select-all');
  if (selectAllCheckbox) {
    selectAllCheckbox.addEventListener('change', function() {
      const checkboxes = document.querySelectorAll('input[name="post_ids"]');
      checkboxes.forEach(cb => cb.checked = this.checked);
    });
  }
});
</script>

<% } else { %>
<!-- No Posts -->
<div class="empty-state">
  <h3>No Posts Found</h3>
  <p>Get started by creating your first blog post.</p>
  <a href="/admin/posts/new" role="button" hx-get="/admin/posts/new" hx-target="#main-content" hx-push-url="true">Create New Post</a>
</div>
<% } %>
