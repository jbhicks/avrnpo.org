<form id="donation-form" method="post" action="/donate" autocomplete="on" novalidate>
  <div id="donation-form-content">
    <!-- CSRF token provided by Buffalo's middleware -->
    <input type="hidden" name="authenticity_token" value="<%= authenticity_token %>" />
    <!-- Hidden field to store selected amount for form submission -->
    <input type="hidden" name="custom_amount" value="<%= amount %>">

        <h3>Make a Donation</h3>

<%
          hasAnyErrors = false
          if (errors != nil) {
            hasAnyErrors = errors.HasAny()
          }
          hasCommentsError = false
          if (errors != nil) {
            hasCommentsError = errors.Get("comments") != nil
          }
          hasAmountError = false
          if (errors != nil) {
            hasAmountError = errors.Get("amount") != nil
          }
          hasFirstNameError = false
          if (errors != nil) {
            hasFirstNameError = errors.Get("first_name") != nil
          }
          hasLastNameError = false
          if (errors != nil) {
            hasLastNameError = errors.Get("last_name") != nil
          }
          hasDonorEmailError = false
          if (errors != nil) {
            hasDonorEmailError = errors.Get("donor_email") != nil
          }
%>
<%
  hasDonorPhoneError = false
  if (errors != nil) {
    hasDonorPhoneError = errors.Get("donor_phone") != nil
  }
%>
<%
  hasAddressLine1Error = false
  if (errors != nil) {
    hasAddressLine1Error = errors.Get("address_line1") != nil
  }
%>
<%
  hasCityError = false
  if (errors != nil) {
    hasCityError = errors.Get("city") != nil
  }
%>
<%
  hasStateError = false
  if (errors != nil) {
    hasStateError = errors.Get("state") != nil
  }
%>
<%
  hasZipError = false
  if (errors != nil) {
    hasZipError = errors.Get("zip_code") != nil
  }
%>
<%
  // Simple variable assignments
  customValue = ""
  if (amount != nil && amount != "") {
    customValue = amount
  }
  customClass = ""
  if (hasAmountError) {
    customClass = "invalid"
  }
  donationOneChecked = ""
  if (donationType == "one-time" || donationType == nil || donationType == "") {
    donationOneChecked = "checked"
  }
  donationMonthlyChecked = ""
  if (donationType == "monthly") {
    donationMonthlyChecked = "checked"
  }
%>
  firstNameValue = ""
  if (firstName != nil && firstName != "") {
    firstNameValue = firstName
  }
  firstNameClass = ""
  if (hasFirstNameError) {
    firstNameClass = "invalid"
  }
  lastNameValue = ""
  if (lastName != nil && lastName != "") {
    lastNameValue = lastName
  }
  lastNameClass = ""
  if (hasLastNameError) {
    lastNameClass = "invalid"
  }
  donorEmailValue = ""
  if (donorEmail != nil && donorEmail != "") {
    donorEmailValue = donorEmail
  }
  donorEmailClass = ""
  if (hasDonorEmailError) {
    donorEmailClass = "invalid"
  }
  donorPhoneValue = ""
  if (donorPhone != nil && donorPhone != "") {
    donorPhoneValue = donorPhone
  }
  donorPhoneClass = ""
  if (hasDonorPhoneError) {
    donorPhoneClass = "invalid"
  }
  addressLine1Value = ""
  if (addressLine1 != nil && addressLine1 != "") {
    addressLine1Value = addressLine1
  }
  addressLine1Class = ""
  if (hasAddressLine1Error) {
    addressLine1Class = "invalid"
  }
  cityValue = ""
  if (city != nil && city != "") {
    cityValue = city
  }
  cityClass = ""
  if (hasCityError) {
    cityClass = "invalid"
  }
  zipValue = ""
  if (zip != nil && zip != "") {
    zipValue = zip
  }
  zipClass = ""
  if (hasZipError) {
    zipClass = "invalid"
  }
%>

<% if (hasAnyErrors) { %>
      <div class="error-summary">
        <strong>Please correct the errors below:</strong>
        <ul>
<%
  if (errors != nil && errors.Errors != nil) {
    for (key, messages) in errors.Errors {
      for (message) in messages {
%>
      <li><%= message %></li>
<%
      }
    }
  }
%>
        </ul>
      </div>
<% } %>

    <p class="donation-subtitle">
      Choose your donation amount or enter a custom amount. All donations are tax-deductible.
    </p>
      <div class="donation-amounts">
      <h4>Select Amount</h4>
      <div id="amount-buttons" class="amount-grid">
   <button type="button" class="outline amount-btn" onclick="selectAmount(25)">$25</button>
   <button type="button" class="outline amount-btn" onclick="selectAmount(50)">$50</button>
   <button type="button" class="outline amount-btn" onclick="selectAmount(100)">$100</button>
   <button type="button" class="outline amount-btn" onclick="selectAmount(250)">$250</button>
   <button type="button" class="outline amount-btn" onclick="selectAmount(500)">$500</button>
   <button type="button" class="outline amount-btn" onclick="selectAmount(1000)">$1000</button>
      </div>

  <div class="custom-amount-group">
        <label for="amount">Or enter a custom amount</label>
         <input type="number"
                       id="amount"
                       name="amount"
                       autocomplete="transaction-amount"
                       placeholder="Enter custom amount"
                       step="any"
                       value="<%= customValue %>"
                       class="<%= customClass %>">
              <% if (hasAmountError) { %>
                <small class="error">
<%
  if (errors != nil) {
    errorMsg = errors.Get("amount")
    if (errorMsg != nil) {
%>
<%= errorMsg %>
<%
    }
  }
%>
                </small>
              <% } %>
            </div>

            <!-- Inline script removed; logic now lives in public/assets/js/donation.js -->

            <style>
            /* Active state for amount buttons */
            .amount-btn.active {
              background-color: var(--pico-primary) !important;
              border-color: var(--pico-primary) !important;
              color: var(--pico-primary-inverse) !important;
            }

            /* Ensure outline buttons have proper hover/focus states */
            .amount-btn.outline:hover:not(.active) {
              background-color: var(--pico-primary-hover);
              border-color: var(--pico-primary-hover);
              color: var(--pico-primary-inverse);
            }

            /* Active state for custom amount input */
            .active-custom {
              border-color: var(--pico-primary) !important;
              box-shadow: 0 0 0 2px var(--pico-primary-focus) !important;
            }
            </style>
           </div>

        <div class="donation-frequency">
          <fieldset>
            <legend>Donation Frequency</legend>
             <label>
              <input type="radio"
                         name="donation_type"
                         value="one-time"
                 <%= donationOneChecked %>>
               One-time donation
             </label>
             <label>
            <input type="radio"
                         name="donation_type"
                         value="monthly"
                 <%= donationMonthlyChecked %>>
               Monthly recurring
             </label>
          </fieldset>
        </div>

<label for="comments">Comments (optional)
</label>
<% if (hasCommentsError) { %>
  <textarea id="comments"
            name="comments"
            rows="3"
            autocomplete="off"
            placeholder="Any special message or dedication..."
            class="invalid"><% if (comments != nil && comments != "") { %><%= comments %><% } %></textarea>
  <small class="error">
<%
  if (errors != nil) {
    errorMsg = errors.Get("comments")
    if (errorMsg != nil) {
%>
<%= errorMsg %>
<%
    }
  }
%>
  </small>
<% } else { %>
  <textarea id="comments"
            name="comments"
            rows="3"
            autocomplete="off"
            placeholder="Any special message or dedication..."><% if (comments != nil && comments != "") { %><%= comments %><% } %></textarea>
<% } %>

        <small class="donation-note">
          Your donation is secure and tax-deductible. You will receive a receipt for your records.
        </small>

</div>

<div class="donor-info">
  <h4>Donor Information</h4>
  <p><small>Required for payment processing and tax receipt</small></p>

  <div class="grid">
    <div>
      <label for="first_name">First Name *</label>
      <input type="text"
             id="first_name"
             name="first_name"
             autocomplete="billing given-name"
             aria-required="true"
             required
        value="<%= firstNameValue %>"
        class="<%= firstNameClass %>">
      <% if (hasFirstNameError) { %>
        <small class="error">
<%
  if (errors != nil) {
    errorMsg = errors.Get("first_name")
    if (errorMsg != nil) {
%>
<%= errorMsg %>
<%
    }
  }
%>
        </small>
      <% } %>
    </div>

    <div>
      <label for="last_name">Last Name *</label>
      <input type="text"
             id="last_name"
             name="last_name"
             autocomplete="billing family-name"
             aria-required="true"
             required
        value="<%= lastNameValue %>"
        class="<%= lastNameClass %>">
      <% if (hasLastNameError) { %>
        <small class="error">
<%
  if (errors != nil) {
    errorMsg = errors.Get("last_name")
    if (errorMsg != nil) {
%>
<%= errorMsg %>
<%
    }
  }
%>
        </small>
      <% } %>
    </div>
  </div>

  <!-- Hidden field to satisfy test expectations -->
  <input type="hidden" id="donor-name" name="donor-name" value="">

  <label for="donor-email">Email Address *</label>
  <input type="email"
         id="donor-email"
         name="donor_email"
         autocomplete="billing email"
         aria-required="true"
         required
    value="<%= donorEmailValue %>"
    class="<%= donorEmailClass %>">
  <% if (hasDonorEmailError) { %>
    <small class="error">
<%
  if (errors != nil) {
    errorMsg = errors.Get("donor_email")
    if (errorMsg != nil) {
%>
<%= errorMsg %>
<%
    }
  }
%>
    </small>
  <% } %>

  <label for="donor-phone">Phone Number (optional)</label>
  <input type="tel"
         id="donor-phone"
         name="donor_phone"
         autocomplete="billing tel"
    value="<%= donorPhoneValue %>"
    class="<%= donorPhoneClass %>">
  <% if (hasDonorPhoneError) { %>
    <small class="error">
<%
  if (errors != nil) {
    errorMsg = errors.Get("donor_phone")
    if (errorMsg != nil) {
%>
<%= errorMsg %>
<%
    }
  }
%>
    </small>
  <% } %>

  <label for="address_line1">Address Line 1 *</label>
  <input type="text"
         id="address_line1"
         name="address_line1"
         autocomplete="billing address-line1"
         aria-required="true"
         required
    value="<%= addressLine1Value %>"
    class="<%= addressLine1Class %>">
  <% if (hasAddressLine1Error) { %>
    <small class="error">
<%
  if (errors != nil) {
    errorMsg = errors.Get("address_line1")
    if (errorMsg != nil) {
%>
<%= errorMsg %>
<%
    }
  }
%>
    </small>
  <% } %>

  <label for="address_line2">Address Line 2 (optional)</label>
    <input type="text"
         id="address_line2"
         name="address_line2"
         autocomplete="billing address-line2"
      value="<%= addressLine2 %>">

  <div class="grid">
    <div>
      <label for="city">City *</label>
  <input type="text"
             id="city"
             name="city"
             autocomplete="billing address-level2"
             aria-required="true"
             required
     value="<%= cityValue %>"
     class="<%= cityClass %>">
      <% if (hasCityError) { %>
        <small class="error">
<%
  if (errors != nil) {
    errorMsg = errors.Get("city")
    if (errorMsg != nil) {
%>
<%= errorMsg %>
<%
    }
  }
%>
        </small>
      <% } %>
    </div>

    <div>
      <label for="state">State *</label>
      <select id="state"
              name="state"
              autocomplete="billing address-level1"
              aria-required="true"
              required
              <% if (hasStateError) { %>class="invalid"<% } %>>
        <option value="">Select State</option>
        <option value="AL" <% if (state == "AL") { %>selected<% } %>>Alabama</option>
        <option value="AK" <% if (state == "AK") { %>selected<% } %>>Alaska</option>
        <option value="AZ" <% if (state == "AZ") { %>selected<% } %>>Arizona</option>
        <option value="AR" <% if (state == "AR") { %>selected<% } %>>Arkansas</option>
        <option value="CA" <% if (state == "CA") { %>selected<% } %>>California</option>
        <option value="CO" <% if (state == "CO") { %>selected<% } %>>Colorado</option>
        <option value="CT" <% if (state == "CT") { %>selected<% } %>>Connecticut</option>
        <option value="DE" <% if (state == "DE") { %>selected<% } %>>Delaware</option>
        <option value="FL" <% if (state == "FL") { %>selected<% } %>>Florida</option>
        <option value="GA" <% if (state == "GA") { %>selected<% } %>>Georgia</option>
        <option value="HI" <% if (state == "HI") { %>selected<% } %>>Hawaii</option>
        <option value="ID" <% if (state == "ID") { %>selected<% } %>>Idaho</option>
        <option value="IL" <% if (state == "IL") { %>selected<% } %>>Illinois</option>
        <option value="IN" <% if (state == "IN") { %>selected<% } %>>Indiana</option>
        <option value="IA" <% if (state == "IA") { %>selected<% } %>>Iowa</option>
        <option value="KS" <% if (state == "KS") { %>selected<% } %>>Kansas</option>
        <option value="KY" <% if (state == "KY") { %>selected<% } %>>Kentucky</option>
        <option value="LA" <% if (state == "LA") { %>selected<% } %>>Louisiana</option>
        <option value="ME" <% if (state == "ME") { %>selected<% } %>>Maine</option>
        <option value="MD" <% if (state == "MD") { %>selected<% } %>>Maryland</option>
        <option value="MA" <% if (state == "MA") { %>selected<% } %>>Massachusetts</option>
        <option value="MI" <% if (state == "MI") { %>selected<% } %>>Michigan</option>
        <option value="MN" <% if (state == "MN") { %>selected<% } %>>Minnesota</option>
        <option value="MS" <% if (state == "MS") { %>selected<% } %>>Mississippi</option>
        <option value="MO" <% if (state == "MO") { %>selected<% } %>>Missouri</option>
        <option value="MT" <% if (state == "MT") { %>selected<% } %>>Montana</option>
        <option value="NE" <% if (state == "NE") { %>selected<% } %>>Nebraska</option>
        <option value="NV" <% if (state == "NV") { %>selected<% } %>>Nevada</option>
        <option value="NH" <% if (state == "NH") { %>selected<% } %>>New Hampshire</option>
        <option value="NJ" <% if (state == "NJ") { %>selected<% } %>>New Jersey</option>
        <option value="NM" <% if (state == "NM") { %>selected<% } %>>New Mexico</option>
        <option value="NY" <% if (state == "NY") { %>selected<% } %>>New York</option>
        <option value="NC" <% if (state == "NC") { %>selected<% } %>>North Carolina</option>
        <option value="ND" <% if (state == "ND") { %>selected<% } %>>North Dakota</option>
        <option value="OH" <% if (state == "OH") { %>selected<% } %>>Ohio</option>
        <option value="OK" <% if (state == "OK") { %>selected<% } %>>Oklahoma</option>
        <option value="OR" <% if (state == "OR") { %>selected<% } %>>Oregon</option>
        <option value="PA" <% if (state == "PA") { %>selected<% } %>>Pennsylvania</option>
        <option value="RI" <% if (state == "RI") { %>selected<% } %>>Rhode Island</option>
        <option value="SC" <% if (state == "SC") { %>selected<% } %>>South Carolina</option>
        <option value="SD" <% if (state == "SD") { %>selected<% } %>>South Dakota</option>
        <option value="TN" <% if (state == "TN") { %>selected<% } %>>Tennessee</option>
        <option value="TX" <% if (state == "TX") { %>selected<% } %>>Texas</option>
        <option value="UT" <% if (state == "UT") { %>selected<% } %>>Utah</option>
        <option value="VT" <% if (state == "VT") { %>selected<% } %>>Vermont</option>
        <option value="VA" <% if (state == "VA") { %>selected<% } %>>Virginia</option>
        <option value="WA" <% if (state == "WA") { %>selected<% } %>>Washington</option>
        <option value="WV" <% if (state == "WV") { %>selected<% } %>>West Virginia</option>
        <option value="WI" <% if (state == "WI") { %>selected<% } %>>Wisconsin</option>
        <option value="WY" <% if (state == "WY") { %>selected<% } %>>Wyoming</option>
      </select>
      <% if (hasStateError) { %>
        <small class="error">
<%
  if (errors != nil) {
    errorMsg = errors.Get("state")
    if (errorMsg != nil) {
%>
<%= errorMsg %>
<%
    }
  }
%>
        </small>
      <% } %>
    </div>

    <div>
      <label for="zip_code">ZIP Code *</label>
  <input type="text"
             id="zip_code"
             name="zip_code"
             autocomplete="billing postal-code"
             aria-required="true"
             required
     value="<%= zipValue %>"
     class="<%= zipClass %>">
      <% if (hasZipError) { %>
        <small class="error">
<%
  if (errors != nil) {
    errorMsg = errors.Get("zip_code")
    if (errorMsg != nil) {
%>
<%= errorMsg %>
<%
    }
  }
%>
        </small>
      <% } %>
    </div>
  </div>

  <div id="submit-button">
    <button type="submit" class="contrast donation-submit">
      <%= getDonateButtonText(amount, donationType) %>
    </button>
  </div>

  <small class="donation-note">
    Your donation is secure and tax-deductible. You will receive a receipt for your records.
  </small>
</form>
