<div id="amount-selection">
  <input type="hidden" name="authenticity_token" value="<%= authenticity_token %>">
  <input type="hidden" name="donation_type" value="<%= donationType %>">
  <input type="hidden" name="amount" value="<%= if (amount && amount != "") { %><%= amount %><% } else if (customAmount && customAmount != "") { %><%= customAmount %><% } else { %><%# empty to avoid nil %><% } %>">
  <div class="amount-grid" role="radiogroup" aria-label="Donation amount">
    <% let presetAmounts = ["25", "50", "100", "250", "500", "1000"] %>
    <%= for (preset) in presetAmounts { %>
      <% let isActive = ((amount && amount != "" && amount == preset) || (!amount && customAmount && customAmount == preset)) %>
      <% let btnClass = "outline amount-btn" %>
      <% if (isActive) { btnClass = btnClass + " active" } %>
      <button type="button"
              class="<%= btnClass %>"
              data-amount="<%= preset %>"
              aria-pressed="<%= if (isActive) { %>true<% } else { %>false<% } %>"
              hx-patch="/donate/update-amount"
               hx-vals='{"amount": "<%= preset %>", "source": "preset", "donation_type": "<%= donationType %>"}'
           hx-include="closest form"
           hx-headers='{"X-CSRF-Token": "<%= authenticity_token %>"}'
              hx-target="#amount-selection"
              hx-swap="outerHTML">
        $<%= preset %>
      </button>
    <% } %>
  </div>

  <!-- Keep a canonical hidden amount field so server receives the selection -->
  <input type="hidden" name="amount" value="<%= if (amount && amount != "") { %><%= amount %><% } else if (customAmount && customAmount != "") { %><%= customAmount %><% } else { %><%# empty to avoid nil %><% } %>">

  <div class="custom-amount-group" style="margin-top:1em;">
    <label for="custom_amount">Or enter a custom amount</label>
    <input type="number"
           id="custom_amount"
           name="custom_amount"
           autocomplete="transaction-amount"
           placeholder="Enter custom amount"
           step="1"
           min="1"
           value="<%= if (amount && amount != "") { %><%= amount %><% } else if (customAmount && customAmount != "") { %><%= customAmount %><% } %>"
           hx-patch="/donate/update-amount"
           hx-trigger="change, blur delay:300ms from:#custom_amount"
           hx-include="closest form"
           hx-vals='{"source": "custom"}'
           hx-target="#amount-selection"
           hx-swap="outerHTML">
    <%= if (hasAmountError) { %>
      <small class="error" style="color: var(--pico-del-color); display:block; margin-top: .25rem;">
        <%= errors.Get("amount")[0] %>
      </small>
    <% } %>
  </div>
</div>

<style>
/* Active state for amount buttons */
.amount-btn.active {
  background-color: var(--pico-primary) !important;
  border-color: var(--pico-primary) !important;
  color: var(--pico-primary-inverse) !important;
}

/* Ensure outline buttons have proper hover/focus states */
.amount-btn.outline:hover {
  background-color: var(--pico-primary-hover);
  border-color: var(--pico-primary-hover);
  color: var(--pico-primary-inverse);
}

/* Custom amount input uses default styling; no active background */
</style>
